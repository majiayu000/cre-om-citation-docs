<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OM Generator System Architecture</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    :root {
      --primary: #1a365d;
      --primary-light: #ebf4ff;
      --secondary: #2b6cb0;
      --accent: #ed8936;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-600: #4b5563;
      --gray-800: #1f2937;
      --green-100: #dcfce7;
      --green-700: #15803d;
      --yellow-100: #fef9c3;
      --yellow-700: #a16207;
      --red-100: #fee2e2;
      --red-700: #b91c1c;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: var(--gray-800);
      background: var(--gray-50);
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

    header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 3rem 2rem;
      margin-bottom: 2rem;
      border-radius: 12px;
    }

    header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
    header p { opacity: 0.9; font-size: 1.1rem; }

    .meta {
      display: flex;
      gap: 2rem;
      margin-top: 1rem;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    nav {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    nav h2 { font-size: 1.2rem; margin-bottom: 1rem; color: var(--gray-600); }

    nav ul {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 0.5rem;
    }

    nav a {
      color: var(--secondary);
      text-decoration: none;
      padding: 0.5rem;
      display: block;
      border-radius: 6px;
      transition: background 0.2s;
    }

    nav a:hover { background: var(--primary-light); }

    section {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    h2 {
      color: var(--primary);
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--primary-light);
    }

    h3 { font-size: 1.3rem; margin: 1.5rem 0 1rem; color: var(--gray-800); }
    h4 { font-size: 1.1rem; margin: 1rem 0 0.5rem; color: var(--gray-600); }
    p { margin-bottom: 1rem; }

    .diagram-container {
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      overflow-x: auto;
      position: relative;
    }

    .diagram-container .mermaid {
      display: flex;
      justify-content: center;
      min-height: 400px;
    }

    .diagram-title {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--gray-600);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .fullscreen-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
    }

    .fullscreen-btn:hover { background: var(--secondary); }

    .diagram-container.fullscreen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 1000;
      border-radius: 0;
      margin: 0;
      background: white;
      display: flex;
      flex-direction: column;
    }

    .diagram-container.fullscreen .mermaid {
      flex: 1;
      overflow: auto;
      min-height: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
    }

    th { background: var(--gray-100); font-weight: 600; }
    tr:hover { background: var(--gray-50); }

    code {
      background: var(--gray-100);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
    }

    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1.5rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
    }

    pre code { background: none; padding: 0; color: inherit; }

    .decision-card {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border: 1px solid #bae6fd;
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .decision-card h4 { color: #0369a1; margin-top: 0; }

    .section-flow {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .section-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
      background: var(--primary-light);
      color: var(--primary);
    }

    .section-badge.required { background: var(--green-100); color: var(--green-700); }
    .section-badge.optional { background: var(--yellow-100); color: var(--yellow-700); }

    .arrow { color: var(--gray-600); font-size: 1.2rem; }

    .agent-card {
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }

    .agent-card h5 {
      color: var(--primary);
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .agent-card ul { margin-left: 1.5rem; }

    .layer-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-right: 0.5rem;
    }

    .layer-input { background: #dbeafe; color: #1e40af; }
    .layer-parsing { background: #fef3c7; color: #92400e; }
    .layer-enrichment { background: #d1fae5; color: #065f46; }
    .layer-generation { background: #e0e7ff; color: #3730a3; }
    .layer-render { background: #fce7f3; color: #9d174d; }
    .layer-output { background: #f3e8ff; color: #6b21a8; }

    @media (max-width: 768px) {
      .container { padding: 1rem; }
      header { padding: 2rem 1rem; }
      header h1 { font-size: 1.8rem; }
      .meta { flex-direction: column; gap: 0.5rem; }
      nav ul { grid-template-columns: 1fr; }
      section { padding: 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>OM Generator System Architecture</h1>
      <p>CRE OM Generator - å¤šAgentç³»ç»Ÿæ¶æ„æŠ€æœ¯è§„èŒƒ (PDFä¼˜å…ˆ)</p>
      <div class="meta">
        <span>Version: 1.0.0</span>
        <span>Last Updated: 2026-01-13</span>
        <span>Output: PDF (Letter 8.5" x 11")</span>
      </div>
    </header>

    <nav>
      <h2>ç›®å½•</h2>
      <ul>
        <li><a href="#decisions">1. æ ¸å¿ƒå†³ç­–</a></li>
        <li><a href="#architecture">2. ç³»ç»Ÿæ¶æ„</a></li>
        <li><a href="#sections">3. å›ºå®šSectionç»“æ„</a></li>
        <li><a href="#agents">4. Agentè¯¦ç»†è®¾è®¡</a></li>
        <li><a href="#dataflow">5. æ•°æ®æµå‘</a></li>
        <li><a href="#template">6. æ¨¡æ¿ç³»ç»Ÿ</a></li>
        <li><a href="#render">7. PDFæ¸²æŸ“å¼•æ“</a></li>
        <li><a href="#map">8. åœ°å›¾æ ‡æ³¨ç³»ç»Ÿ</a></li>
        <li><a href="#table">9. è¡¨æ ¼æ ·å¼ç³»ç»Ÿ</a></li>
        <li><a href="#userflow">10. ç”¨æˆ·äº¤äº’æµç¨‹</a></li>
      </ul>
    </nav>

    <!-- Section 1: æ ¸å¿ƒå†³ç­– -->
    <section id="decisions">
      <h2>1. æ ¸å¿ƒå†³ç­–</h2>

      <div class="decision-card">
        <h4>å·²ç¡®è®¤çš„äº§å“å†³ç­–</h4>
        <table>
          <thead>
            <tr><th>å†³ç­–ç‚¹</th><th>é€‰æ‹©</th><th>è¯´æ˜</th></tr>
          </thead>
          <tbody>
            <tr><td>è¾“å‡ºæ ¼å¼</td><td><strong>PDFä¼˜å…ˆ</strong></td><td>Letterå°ºå¯¸ (8.5" x 11")</td></tr>
            <tr><td>Sectioné¡ºåº</td><td><strong>å›ºå®š</strong></td><td>9ä¸ªæ ‡å‡†Sectionï¼Œé¡ºåºä¸å¯è°ƒ</td></tr>
            <tr><td>å›¾ç‰‡æ¥æº</td><td><strong>ç”¨æˆ·ä¸Šä¼ </strong></td><td>ä¸åšç½‘ä¸Šæœç´¢å›¾ç‰‡</td></tr>
            <tr><td>è¡¨æ ¼å¤æ‚åº¦</td><td><strong>ç®€å•</strong></td><td>ä¸“æ³¨ç¾è§‚å¸ƒå±€å’Œä¸»é¢˜è‰²</td></tr>
            <tr><td>åœ°å›¾</td><td><strong>é™æ€+æ ‡æ³¨</strong></td><td>ç”¨æˆ·ä¸Šä¼ åº•å›¾ï¼Œç³»ç»Ÿæ·»åŠ æ ‡æ³¨</td></tr>
            <tr><td>Deep Search</td><td><strong>å¯é€‰</strong></td><td>ä»…Transit/Amenities/Sponsor</td></tr>
          </tbody>
        </table>
      </div>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>è®¾è®¡åŸåˆ™</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
graph LR
    subgraph "è®¾è®¡åŸåˆ™"
        P1[æ¨¡æ¿é©±åŠ¨<br/>ä¸¥æ ¼æŒ‰ç”¨æˆ·æ¨¡æ¿é£æ ¼]
        P2[Citationä¼˜å…ˆ<br/>æ¯ä¸ªæ•°æ®ç‚¹å¯è¿½æº¯]
        P3[ç”¨æˆ·å¯æ§<br/>å…³é”®èŠ‚ç‚¹äººå·¥å¹²é¢„]
        P4[PDFç¾è§‚<br/>ä¸“ä¸šçº§å•†ä¸šæŠ¥å‘Š]
        P5[å›ºå®šæµç¨‹<br/>Sectioné¡ºåºå›ºå®š]
    end
    P1 --> P2 --> P3 --> P4 --> P5
        </div>
      </div>
    </section>

    <!-- Section 2: ç³»ç»Ÿæ¶æ„ -->
    <section id="architecture">
      <h2>2. ç³»ç»Ÿæ¶æ„</h2>

      <h3>2.1 åˆ†å±‚æ¶æ„æ€»è§ˆ</h3>
      <div class="diagram-container">
        <div class="diagram-title">
          <span>å…­å±‚ç³»ç»Ÿæ¶æ„</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart TB
    subgraph L1["Layer 1: INPUT è¾“å…¥å±‚"]
        T1[Template<br/>æ¨¡æ¿é€‰æ‹©]
        T2[Data Files<br/>Excel/PDF]
        T3[Assets<br/>å›¾ç‰‡/Logo/åœ°å›¾]
    end

    subgraph L2["Layer 2: PARSING è§£æå±‚"]
        A1[Template Analyzer<br/>æ¨¡æ¿åˆ†æå™¨]
        A2[Excel Parser<br/>Excelè§£æå™¨]
        A3[PDF Parser<br/>PDFè§£æå™¨]
    end

    subgraph L3["Layer 3: ENRICHMENT å¢å¼ºå±‚ å¯é€‰"]
        DS[Deep Search Agent<br/>Transit/Amenities/Sponsor]
    end

    subgraph L4["Layer 4: GENERATION ç”Ÿæˆå±‚"]
        CG[Content Generation Agent<br/>Claude: æŒ‰Sectionç”Ÿæˆ+Citation]
    end

    subgraph L5["Layer 5: RENDER æ¸²æŸ“å±‚"]
        RE[PDF Render Engine<br/>React+Tailwind+Puppeteer]
        MA[Map Annotator<br/>åœ°å›¾æ ‡æ³¨]
    end

    subgraph L6["Layer 6: OUTPUT è¾“å‡º"]
        PDF[PDF<br/>8.5x11 Letter]
    end

    T1 --> A1
    T2 --> A2
    T2 --> A3
    T3 --> RE

    A1 --> CG
    A2 --> CG
    A3 --> CG
    DS -.-> CG

    CG --> RE
    MA --> RE
    RE --> PDF

    style L1 fill:#dbeafe
    style L2 fill:#fef3c7
    style L3 fill:#d1fae5
    style L4 fill:#e0e7ff
    style L5 fill:#fce7f3
    style L6 fill:#f3e8ff
        </div>
      </div>

      <h3>2.2 å„å±‚è¯´æ˜</h3>
      <table>
        <thead>
          <tr><th>å±‚çº§</th><th>åç§°</th><th>èŒè´£</th><th>ä¸»è¦ç»„ä»¶</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="layer-badge layer-input">L1</span></td>
            <td>INPUT</td>
            <td>æ¥æ”¶ç”¨æˆ·è¾“å…¥</td>
            <td>æ¨¡æ¿é€‰æ‹©ã€æ–‡ä»¶ä¸Šä¼ ã€ç´ æä¸Šä¼ </td>
          </tr>
          <tr>
            <td><span class="layer-badge layer-parsing">L2</span></td>
            <td>PARSING</td>
            <td>è§£æè¾“å…¥æ–‡ä»¶</td>
            <td>Template Analyzer, Excel/PDF Parser</td>
          </tr>
          <tr>
            <td><span class="layer-badge layer-enrichment">L3</span></td>
            <td>ENRICHMENT</td>
            <td>æ•°æ®å¢å¼º(å¯é€‰)</td>
            <td>Deep Search Agent</td>
          </tr>
          <tr>
            <td><span class="layer-badge layer-generation">L4</span></td>
            <td>GENERATION</td>
            <td>ç”ŸæˆOMå†…å®¹</td>
            <td>Content Generation Agent (Claude)</td>
          </tr>
          <tr>
            <td><span class="layer-badge layer-render">L5</span></td>
            <td>RENDER</td>
            <td>æ¸²æŸ“ä¸ºPDF</td>
            <td>PDF Render Engine, Map Annotator</td>
          </tr>
          <tr>
            <td><span class="layer-badge layer-output">L6</span></td>
            <td>OUTPUT</td>
            <td>è¾“å‡ºæœ€ç»ˆPDF</td>
            <td>PDFæ–‡ä»¶ (Letterå°ºå¯¸)</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Section 3: å›ºå®šSectionç»“æ„ -->
    <section id="sections">
      <h2>3. å›ºå®šSectionç»“æ„</h2>

      <h3>3.1 Sectioné¡ºåº</h3>
      <div class="section-flow">
        <span class="section-badge required">1. Cover</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">2. TOC</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">3. Executive Summary</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">4. Property Overview</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">5. Location Overview</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">6. Financial Analysis</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">7. Tenant Overview</span>
        <span class="arrow">â†’</span>
        <span class="section-badge required">8. Sponsor Overview</span>
        <span class="arrow">â†’</span>
        <span class="section-badge optional">9. Appendix (å¯é€‰)</span>
      </div>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>Sectionç”Ÿæˆæµç¨‹</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart LR
    subgraph "å›ºå®šSectioné¡ºåº"
        S1[1.Cover<br/>å°é¢<br/>1é¡µ]
        S2[2.TOC<br/>ç›®å½•<br/>1é¡µ]
        S3[3.Exec Summary<br/>æŠ•èµ„äº®ç‚¹<br/>1-2é¡µ]
        S4[4.Property<br/>ç‰©ä¸šæ¦‚è¿°<br/>2-4é¡µ]
        S5[5.Location<br/>ä½ç½®äº¤é€š<br/>2-3é¡µ]
        S6[6.Financial<br/>è´¢åŠ¡åˆ†æ<br/>3-5é¡µ]
        S7[7.Tenant<br/>ç§Ÿæˆ·æ¦‚è¿°<br/>1-2é¡µ]
        S8[8.Sponsor<br/>å¼€å‘å•†<br/>1é¡µ]
        S9[9.Appendix<br/>é™„å½•<br/>å¯é€‰]
    end

    S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> S7 --> S8 --> S9

    style S1 fill:#1a365d,color:#fff
    style S9 fill:#fef3c7
        </div>
      </div>

      <h3>3.2 Sectionè¯¦ç»†è¯´æ˜</h3>
      <table>
        <thead>
          <tr><th>#</th><th>Section</th><th>å†…å®¹</th><th>é¡µæ•°</th><th>å¿…éœ€</th></tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>Cover Page</td><td>å°é¢ã€ç‰©ä¸šä¸»å›¾ã€æ ‡é¢˜ã€Brokerä¿¡æ¯</td><td>1</td><td>æ˜¯</td></tr>
          <tr><td>2</td><td>Table of Contents</td><td>è‡ªåŠ¨ç”Ÿæˆç›®å½•å’Œé¡µç </td><td>1</td><td>æ˜¯</td></tr>
          <tr><td>3</td><td>Executive Summary</td><td>Investment Highlights, Key Metrics</td><td>1-2</td><td>æ˜¯</td></tr>
          <tr><td>4</td><td>Property Overview</td><td>ç‰©ä¸šæè¿°ã€è§„æ ¼ã€å›¾ç‰‡ã€Amenities</td><td>2-4</td><td>æ˜¯</td></tr>
          <tr><td>5</td><td>Location Overview</td><td>ä½ç½®æè¿°ã€äº¤é€šåœ°å›¾ã€å‘¨è¾¹è®¾æ–½åœ°å›¾</td><td>2-3</td><td>æ˜¯</td></tr>
          <tr><td>6</td><td>Financial Analysis</td><td>è´¢åŠ¡æ‘˜è¦ã€Rent Rollã€è¿è¥æŠ¥è¡¨ã€Pro Forma</td><td>3-5</td><td>æ˜¯</td></tr>
          <tr><td>7</td><td>Tenant Overview</td><td>ç§Ÿæˆ·åˆ—è¡¨ã€ç§Ÿçº¦åˆ°æœŸæ—¶é—´è¡¨ã€ç§Ÿæˆ·å æ¯”</td><td>1-2</td><td>æ˜¯</td></tr>
          <tr><td>8</td><td>Sponsor Overview</td><td>å¼€å‘å•†/ä¸šä¸»ä»‹ç»ã€Track Record</td><td>1</td><td>æ˜¯</td></tr>
          <tr><td>9</td><td>Appendix</td><td>è¯¦ç»†è´¢åŠ¡ã€æ³•å¾‹æ–‡ä»¶ã€è¡¥å……å›¾ç‰‡</td><td>N</td><td>å¦</td></tr>
        </tbody>
      </table>
    </section>

    <!-- Section 4: Agentè¯¦ç»†è®¾è®¡ -->
    <section id="agents">
      <h2>4. Agentè¯¦ç»†è®¾è®¡</h2>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>Agentåä½œæ¶æ„</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart TB
    subgraph "Orchestrator Agent åè°ƒå™¨"
        ORC[ä»»åŠ¡åˆ†è§£<br/>Agentè°ƒåº¦<br/>çŠ¶æ€ç®¡ç†]
    end

    subgraph "è§£æå±‚ Agents"
        TA[Template Analyzer<br/>æ¨¡æ¿åˆ†æ]
        EP[Excel Parser<br/>è´¢åŠ¡æ•°æ®æå–]
        PP[PDF Parser<br/>æ–‡æ¡£è§£æ]
    end

    subgraph "å¢å¼ºå±‚ Agent"
        DS[Deep Search Agent<br/>Transit/Amenities/Sponsor]
    end

    subgraph "ç”Ÿæˆå±‚ Agent"
        CG[Content Generator<br/>Claude API<br/>æŒ‰Sectionç”Ÿæˆ]
    end

    subgraph "æ¸²æŸ“å±‚"
        RE[PDF Render Engine]
        MA[Map Annotator]
    end

    ORC --> TA
    ORC --> EP
    ORC --> PP
    ORC -.-> DS

    TA --> CG
    EP --> CG
    PP --> CG
    DS -.-> CG

    CG --> RE
    MA --> RE
        </div>
      </div>

      <h3>4.1 å„AgentèŒè´£</h3>

      <div class="agent-card">
        <h5>Orchestrator Agent (åè°ƒå™¨)</h5>
        <ul>
          <li>æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œåˆ†è§£ä»»åŠ¡</li>
          <li>è°ƒåº¦å…¶ä»–Agentæ‰§è¡Œ</li>
          <li>ç®¡ç†æ•´ä½“çŠ¶æ€å’Œè¿›åº¦</li>
          <li>å¤„ç†é”™è¯¯å’Œé‡è¯•</li>
          <li>åˆå¹¶å„Agentè¾“å‡º</li>
        </ul>
      </div>

      <div class="agent-card">
        <h5>Template Analyzer (æ¨¡æ¿åˆ†æå™¨)</h5>
        <ul>
          <li>åˆ†æç”¨æˆ·æä¾›çš„æ¨¡æ¿ï¼ˆPDF/ç°æœ‰OMï¼‰</li>
          <li>ä½¿ç”¨Vision AIæå–è®¾è®¡è§„èŒƒ</li>
          <li>è¾“å‡º: Structure, Layout, Style, Components</li>
        </ul>
      </div>

      <div class="agent-card">
        <h5>Excel Parser (Excelè§£æå™¨)</h5>
        <ul>
          <li>è§£æExcelè´¢åŠ¡æ¨¡å‹ (openpyxl)</li>
          <li>æå–è´¢åŠ¡æ•°æ®å¹¶ç»‘å®šCitationä½ç½®</li>
          <li>è¯†åˆ«Rent Rollã€Operating Statementã€Pro Forma</li>
        </ul>
      </div>

      <div class="agent-card">
        <h5>Content Generation Agent (å†…å®¹ç”Ÿæˆå™¨)</h5>
        <ul>
          <li>åŸºäºExtractedDataç”ŸæˆOMå†…å®¹</li>
          <li>æŒ‰å›ºå®šSectioné¡ºåºé€ä¸ªç”Ÿæˆ</li>
          <li>åŒæ­¥ç»‘å®šCitationæ ‡è®°</li>
          <li>ä½¿ç”¨Claude API (Opus 4.5)</li>
        </ul>
      </div>

      <div class="agent-card">
        <h5>Deep Search Agent (å¯é€‰)</h5>
        <ul>
          <li>Transit/äº¤é€šä¿¡æ¯æœç´¢</li>
          <li>Amenities/å‘¨è¾¹è®¾æ–½æœç´¢</li>
          <li>Sponsorä¿¡æ¯è¡¥å……</li>
          <li>æ³¨æ„: ä¸æœç´¢å›¾ç‰‡</li>
        </ul>
      </div>
    </section>

    <!-- Section 5: æ•°æ®æµå‘ -->
    <section id="dataflow">
      <h2>5. æ•°æ®æµå‘</h2>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>å®Œæ•´æ•°æ®æµå‘å›¾</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart LR
    subgraph "ç”¨æˆ·è¾“å…¥"
        U1[Template<br/>æ¨¡æ¿]
        U2[Excel<br/>è´¢åŠ¡æ¨¡å‹]
        U3[PDF<br/>æ–‡æ¡£]
        U4[Images<br/>å›¾ç‰‡]
        U5[Map<br/>åœ°å›¾åº•å›¾]
    end

    subgraph "è§£æå¤„ç†"
        P1[Template<br/>Analyzer]
        P2[Excel<br/>Parser]
        P3[PDF<br/>Parser]
    end

    subgraph "æ•°æ®é›†æˆ"
        DI[Data<br/>Integration<br/>+Citationç»‘å®š]
    end

    subgraph "å†…å®¹ç”Ÿæˆ"
        CG[Content<br/>Generator<br/>Claude]
    end

    subgraph "æ¸²æŸ“å¤„ç†"
        RE[PDF Render<br/>React+Tailwind]
        MA[Map<br/>Annotator]
    end

    subgraph "è¾“å‡º"
        OUT[PDF<br/>8.5x11]
    end

    U1 --> P1
    U2 --> P2
    U3 --> P3
    U4 --> RE
    U5 --> MA

    P1 --> DI
    P2 --> DI
    P3 --> DI

    DI --> CG
    CG --> RE
    MA --> RE
    RE --> OUT
        </div>
      </div>

      <h3>5.1 æ•°æ®ç»“æ„æµè½¬</h3>
      <div class="diagram-container">
        <div class="diagram-title">
          <span>æ ¸å¿ƒæ•°æ®ç»“æ„</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
classDiagram
    class OMProject {
        +string id
        +string propertyAddress
        +PropertyType propertyType
        +Document[] documents
        +Asset[] assets
        +OMDocument generatedOM
    }

    class ExtractedData {
        +FinancialData financials
        +PropertyData property
        +TenantData[] tenants
        +CitationRef[] citations
    }

    class TemplateSpec {
        +PageConfig page
        +ColorSystem colors
        +FontSystem fonts
        +ComponentStyles components
    }

    class GeneratedContent {
        +GeneratedSection[] sections
        +Citation[] citations
    }

    class OMDocument {
        +TemplateSpec templateSpec
        +GeneratedSection[] sections
        +Citation[] citations
        +Buffer pdfBuffer
    }

    OMProject --> ExtractedData
    OMProject --> TemplateSpec
    ExtractedData --> GeneratedContent
    TemplateSpec --> GeneratedContent
    GeneratedContent --> OMDocument
        </div>
      </div>
    </section>

    <!-- Section 6: æ¨¡æ¿ç³»ç»Ÿ -->
    <section id="template">
      <h2>6. æ¨¡æ¿ç³»ç»Ÿ</h2>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>æ¨¡æ¿æ¥æºä¸å¤„ç†</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart TB
    subgraph "æ¨¡æ¿æ¥æº"
        T1[ç”¨æˆ·é¢„åˆ¶æ¨¡æ¿åº“<br/>PropertyType+DealTypeç»„åˆ]
        T2[ç”¨æˆ·ä¸Šä¼ ç°æœ‰OM<br/>ä½œä¸ºæ¨¡æ¿]
        T3[Atlaså†…ç½®æ¨¡æ¿<br/>ç³»ç»Ÿé¢„ç½®]
    end

    subgraph "æ¨¡æ¿åˆ†æ"
        TA[Template Analyzer<br/>Vision AIåˆ†æ]
    end

    subgraph "TemplateSpecè¾“å‡º"
        TS[TemplateSpec<br/>JSONæ ¼å¼]
        S1[Structure<br/>Sectionç»“æ„]
        S2[Layout<br/>é¡µé¢å¸ƒå±€]
        S3[Style<br/>é¢œè‰²å­—ä½“]
        S4[Components<br/>ç»„ä»¶æ ·å¼]
    end

    T1 --> TA
    T2 --> TA
    T3 --> TA

    TA --> TS
    TS --> S1
    TS --> S2
    TS --> S3
    TS --> S4
        </div>
      </div>

      <h3>6.1 æ¨¡æ¿å¤„ç†è§„åˆ™</h3>
      <table>
        <thead>
          <tr><th>æ¨¡æ¿æ¥æº</th><th>Styleå¤„ç†</th><th>è¯´æ˜</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>ç”¨æˆ·é¢„åˆ¶æ¨¡æ¿</td>
            <td><strong>ä¸¥æ ¼æŒ‰ç…§</strong>ç”¨æˆ·æ¨¡æ¿é£æ ¼</td>
            <td>æˆ–å¸®åŠ©ä¼˜åŒ–åä¸¥æ ¼æ‰§è¡Œ</td>
          </tr>
          <tr>
            <td>ä¸Šä¼ ç°æœ‰OM</td>
            <td><strong>ä¸¥æ ¼æŒ‰ç…§</strong>ä¸Šä¼ OMé£æ ¼</td>
            <td>Vision AIæå–è®¾è®¡è§„èŒƒ</td>
          </tr>
          <tr>
            <td>Atlaså†…ç½®æ¨¡æ¿</td>
            <td>AI<strong>å¾®è°ƒ</strong>ä¸»é¢˜è‰²/å­—ä½“</td>
            <td>æ ¹æ®ç‰©ä¸šç‰¹è‰²è°ƒæ•´</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Section 7: PDFæ¸²æŸ“å¼•æ“ -->
    <section id="render">
      <h2>7. PDFæ¸²æŸ“å¼•æ“</h2>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>PDFæ¸²æŸ“æµç¨‹</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart TB
    subgraph "è¾“å…¥"
        I1[TemplateSpec<br/>æ¨¡æ¿è§„èŒƒ]
        I2[GeneratedContent<br/>ç”Ÿæˆå†…å®¹]
        I3[Assets<br/>å›¾ç‰‡ç´ æ]
    end

    subgraph "æ¸²æŸ“æµç¨‹"
        R1[åŠ è½½TemplateSpec]
        R2[é€‰æ‹©Reactç»„ä»¶<br/>æŒ‰Section]
        R3[æ³¨å…¥å†…å®¹æ•°æ®]
        R4[åº”ç”¨CSS<br/>Tailwind+Paged Media]
        R5[ç”ŸæˆHTML]
        R6[Live Preview<br/>ç”¨æˆ·å¯ç¼–è¾‘]
        R7[Puppeteeræ¸²æŸ“]
    end

    subgraph "è¾“å‡º"
        OUT[PDF Buffer<br/>8.5x11 Letter]
    end

    I1 --> R1
    I2 --> R3
    I3 --> R3

    R1 --> R2 --> R3 --> R4 --> R5 --> R6 --> R7 --> OUT

    style R6 fill:#fef3c7
        </div>
      </div>

      <h3>7.1 CSS Paged Media</h3>
      <pre><code>@page {
  size: 8.5in 11in;  /* Letter */
  margin: 0.75in;
}

/* å°é¢é¡µæ— é¡µçœ‰é¡µè„š */
@page cover {
  margin: 0;
  @top-center { content: none; }
  @bottom-center { content: none; }
}

/* Sectionåˆ†é¡µ */
.section {
  page-break-before: always;
}

/* é¿å…è¡¨æ ¼è·¨é¡µæ–­è£‚ */
.table-container {
  page-break-inside: avoid;
}</code></pre>
    </section>

    <!-- Section 8: åœ°å›¾æ ‡æ³¨ç³»ç»Ÿ -->
    <section id="map">
      <h2>8. åœ°å›¾æ ‡æ³¨ç³»ç»Ÿ</h2>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>åœ°å›¾æ ‡æ³¨æµç¨‹</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart LR
    subgraph "è¾“å…¥"
        M1[åœ°å›¾åº•å›¾<br/>ç”¨æˆ·ä¸Šä¼ ]
        M2[ç‰©ä¸šä½ç½®<br/>åæ ‡/ç›¸å¯¹ä½ç½®]
        M3[POIæ•°æ®<br/>æ ‡æ³¨ç‚¹åˆ—è¡¨]
        M4[ä¸»é¢˜è‰²<br/>è·Ÿéšæ¨¡æ¿]
    end

    subgraph "Map Annotator"
        MA1[åŠ è½½åº•å›¾]
        MA2[ç»˜åˆ¶ç‰©ä¸šæ ‡è®°<br/>ä¸»æ ‡æ³¨]
        MA3[ç»˜åˆ¶POIæ ‡æ³¨<br/>ç¼–å·+å›¾æ ‡]
        MA4[ç”Ÿæˆå›¾ä¾‹]
    end

    subgraph "è¾“å‡º"
        OUT1[æ ‡æ³¨ååœ°å›¾<br/>PNG]
        OUT2[å›¾ä¾‹ç»„ä»¶]
    end

    M1 --> MA1
    M2 --> MA2
    M3 --> MA3
    M4 --> MA2
    M4 --> MA3

    MA1 --> MA2 --> MA3 --> MA4
    MA4 --> OUT1
    MA4 --> OUT2
        </div>
      </div>

      <h3>8.1 æ ‡æ³¨ç±»å‹</h3>
      <table>
        <thead>
          <tr><th>ç±»å‹</th><th>å›¾æ ‡</th><th>è¯´æ˜</th></tr>
        </thead>
        <tbody>
          <tr><td>property</td><td>â­</td><td>ç‰©ä¸šä½ç½® (ä¸»æ ‡æ³¨ï¼Œçªå‡ºæ˜¾ç¤º)</td></tr>
          <tr><td>transit</td><td>ğŸš‡</td><td>äº¤é€šç«™ç‚¹ (åœ°é“ã€å…¬äº¤)</td></tr>
          <tr><td>restaurant</td><td>ğŸ½ï¸</td><td>é¤é¥®</td></tr>
          <tr><td>shopping</td><td>ğŸ›’</td><td>è´­ç‰©</td></tr>
          <tr><td>healthcare</td><td>ğŸ¥</td><td>åŒ»ç–—</td></tr>
          <tr><td>education</td><td>ğŸ“</td><td>æ•™è‚²</td></tr>
          <tr><td>finance</td><td>ğŸ¦</td><td>é‡‘è</td></tr>
          <tr><td>custom</td><td>ğŸ“</td><td>è‡ªå®šä¹‰</td></tr>
        </tbody>
      </table>

      <h3>8.2 æ ‡æ³¨ç¤ºä¾‹</h3>
      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      [åœ°å›¾åº•å›¾]                          â”‚
â”‚                                                          â”‚
â”‚        â‘¢ Starbucks              â‘                        â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â‘¡ Subway         â”‚ PROPERTYâ”‚    â‘£ Whole Foods â”‚
â”‚           Station          â”‚   â­    â”‚                   â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                 â‘¤ Chase Bank             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LEGEND                                                  â”‚
â”‚  â­ Subject Property     â‘£ Whole Foods (0.4 mi)        â”‚
â”‚  â‘  Subway (0.1 mi)       â‘¤ Chase Bank (0.3 mi)         â”‚
â”‚  â‘¡ Metro M/R (0.2 mi)                                   â”‚
â”‚  â‘¢ Starbucks (0.2 mi)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
    </section>

    <!-- Section 9: è¡¨æ ¼æ ·å¼ç³»ç»Ÿ -->
    <section id="table">
      <h2>9. è¡¨æ ¼æ ·å¼ç³»ç»Ÿ</h2>

      <h3>9.1 è¡¨æ ¼æ ·å¼å˜ä½“</h3>
      <table>
        <thead>
          <tr><th>æ ·å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹</th></tr>
        </thead>
        <tbody>
          <tr><td>Financial Dark</td><td>è´¢åŠ¡æ‘˜è¦</td><td>æ·±è‰²èƒŒæ™¯ï¼Œçªå‡ºæ•°æ®</td></tr>
          <tr><td>Financial Light</td><td>è´¢åŠ¡è¯¦æƒ…</td><td>æµ…è‰²èƒŒæ™¯ï¼Œæ¸…æ™°æ˜“è¯»</td></tr>
          <tr><td>Striped</td><td>é•¿è¡¨æ ¼</td><td>æ–‘é©¬çº¹ï¼Œä¾¿äºé˜…è¯»</td></tr>
          <tr><td>Card</td><td>å…³é”®æŒ‡æ ‡</td><td>å¡ç‰‡å¼ï¼Œçªå‡ºé‡ç‚¹</td></tr>
        </tbody>
      </table>

      <h3>9.2 Financial Summary ç¤ºä¾‹</h3>
      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FINANCIAL SUMMARY                        [ä¸»é¢˜è‰²èƒŒæ™¯]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Purchase Price    â”‚  Cap Rate    â”‚  NOI               â”‚
â”‚  $15,900,000       â”‚  7.5%        â”‚  $1,192,500        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Metric            â”‚  Year 1      â”‚  Year 2      â”‚ ... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Gross Revenue     â”‚  $2.1M       â”‚  $2.2M       â”‚     â”‚
â”‚  Operating Exp.    â”‚  ($0.9M)     â”‚  ($0.9M)     â”‚     â”‚
â”‚  NOI               â”‚  $1.2M       â”‚  $1.3M       â”‚     â”‚
â”‚  Cash Flow         â”‚  $0.8M       â”‚  $0.9M       â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
    </section>

    <!-- Section 10: ç”¨æˆ·äº¤äº’æµç¨‹ -->
    <section id="userflow">
      <h2>10. ç”¨æˆ·äº¤äº’æµç¨‹</h2>

      <div class="diagram-container">
        <div class="diagram-title">
          <span>å®Œæ•´ç”¨æˆ·æµç¨‹</span>
          <button class="fullscreen-btn" onclick="toggleFullscreen(this)">å…¨å±</button>
        </div>
        <div class="mermaid">
flowchart TB
    subgraph "Step 1-3: é¡¹ç›®è®¾ç½®"
        S1[åˆ›å»ºé¡¹ç›®<br/>ç‰©ä¸šåç§°/åœ°å€/ç±»å‹]
        S2[é€‰æ‹©æ¨¡æ¿<br/>é¢„è®¾/ä¸Šä¼ /Atlas]
        S3[ä¸Šä¼ æ–‡ä»¶<br/>Excel/PDF/å›¾ç‰‡]
    end

    subgraph "Step 4-5: ç¡®è®¤é…ç½®"
        S4[ç¡®è®¤è§£æç»“æœ<br/>ğŸ‘¤ ç”¨æˆ·ç¡®è®¤]
        S5[é…ç½®é€‰é¡¹<br/>Deep Searchå¼€å…³ç­‰]
    end

    subgraph "Step 6: ç”Ÿæˆ"
        S6[ç”ŸæˆOM<br/>æŒ‰Sectioné¡ºåº]
    end

    subgraph "Step 7-8: å®¡æ ¸å¯¼å‡º"
        S7[å®¡æ ¸å’Œç¼–è¾‘<br/>ğŸ‘¤ ç”¨æˆ·ç¼–è¾‘]
        S8[å¯¼å‡ºPDF<br/>æœ€ç»ˆè¾“å‡º]
    end

    S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> S7 --> S8

    style S4 fill:#fef3c7
    style S7 fill:#fef3c7
        </div>
      </div>

      <h3>10.1 ç”¨æˆ·å¹²é¢„ç‚¹</h3>
      <table>
        <thead>
          <tr><th>æ­¥éª¤</th><th>å¹²é¢„ç‚¹</th><th>ç”¨æˆ·æ“ä½œ</th></tr>
        </thead>
        <tbody>
          <tr><td>Step 4</td><td>è§£æç¡®è®¤</td><td>ç¡®è®¤/ä¿®æ”¹æå–çš„æ•°æ®</td></tr>
          <tr><td>Step 5</td><td>é…ç½®</td><td>å¼€å…³åŠŸèƒ½ã€è¾“å…¥è¡¥å……ä¿¡æ¯</td></tr>
          <tr><td>Step 7</td><td>ç¼–è¾‘</td><td>ä¿®æ”¹ç”Ÿæˆçš„å†…å®¹ã€Citation</td></tr>
          <tr><td>Step 8</td><td>ç¡®è®¤</td><td>æœ€ç»ˆç¡®è®¤å¹¶å¯¼å‡º</td></tr>
        </tbody>
      </table>
    </section>

    <footer style="text-align: center; padding: 2rem; color: var(--gray-600);">
      <p>CRE OM Generator - System Architecture Specification</p>
      <p>Version 1.0.0 | 2026-01-13</p>
    </footer>
  </div>

  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis' },
      sequence: { useMaxWidth: true }
    });

    function toggleFullscreen(btn) {
      const container = btn.closest('.diagram-container');
      container.classList.toggle('fullscreen');
      btn.textContent = container.classList.contains('fullscreen') ? 'é€€å‡ºå…¨å±' : 'å…¨å±';
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.diagram-container.fullscreen').forEach(c => {
          c.classList.remove('fullscreen');
          c.querySelector('.fullscreen-btn').textContent = 'å…¨å±';
        });
      }
    });
  </script>
</body>
</html>
